# LoRa 模块操作说明（lorareadme.md）

> 适用于：插针 TTL 转 LoRa 半双工无线数传模块
> 使用对象：树莓派 / MCU / 网关程序
> 本文档只描述**操作流程与工程使用方法**，不重复厂商参数表。

---

## 1. 模块定位（一句话）

本模块是一个 **UART（串口） ⇄ LoRa 无线 的透明传输模块**。

* 你只需要：

  * 控制 **EN / AUX**
  * 通过 **串口 TX/RX** 读写数据
* 不需要：

  * 编写 LoRa 协议
  * 处理 CRC / 扩频 / 前导码

---

## 2. 硬件连接（最小系统）

| 模块引脚    | 连接到主控     | 说明     |
| ------- | --------- | ------ |
| VCC     | 3.3V / 5V | 按模块版本  |
| GND     | GND       | 必须共地   |
| RXD     | 主控 TXD    | 串口发送   |
| TXD     | 主控 RXD    | 串口接收   |
| **EN**  | GPIO 输出   | 低=工作   |
| **AUX** | GPIO 输入   | 忙/闲状态  |
| SET     | GPIO 输出   | 普通使用拉低 |

> ⚠️ 强烈建议：AUX 外接 **4.7k~10kΩ 上拉到 3.3V**，提高稳定性。

---

## 3. 三个关键引脚的真实含义

### 3.1 EN（使能引脚）

| 电平   | 含义              |
| ---- | --------------- |
| LOW  | 模块工作（无线 + 串口开启） |
| HIGH | 模块休眠（无线 + 串口关闭） |

**工程建议**：

* 程序启动后 **EN 一直保持 LOW**
* 不要用 EN 作为“发送触发信号”

---

### 3.2 AUX（状态引脚）

AUX 是模块**唯一对外的状态反馈信号**。

| AUX 电平 | 含义            |
| ------ | ------------- |
| HIGH   | 模块空闲，可发送新数据   |
| LOW    | 模块忙（正在收/发/切换） |

AUX 的用途：

* 判断是否可以发送下一包
* 判断上一包是否处理完成
* 防止缓存溢出、丢包

---

### 3.3 SET（模式引脚）

* 普通透明传输：**一直拉低**
* 仅在参数配置 / 快速通道时使用

---

## 4. 上电与初始化流程（必须遵守）

```text
① 上电
② SET = LOW
③ EN = LOW（进入工作模式）
④ 延时 ≥ 50ms（模块内部初始化）
⑤ 模块进入可用状态
```

> ⚠️ 若 EN 拉低后立刻发串口数据，可能被模块丢弃。

---

## 5. 正确的发送流程（工程级）

### ❌ 不推荐的方式（容易丢包）

```text
EN 拉低 → 串口发送 → sleep(0.5)
```

问题：

* 不同配置下发送时间不同
* 固定延时不可扩展

---

### ✅ 推荐的发送流程（稳定可靠）

```text
1. 确保 EN = LOW
2. 等待 AUX = HIGH（模块空闲）
3. UART.write(data)
4. AUX 变为 LOW（模块开始处理）
5. AUX 重新变为 HIGH（发送完成）
6. 允许发送下一包
```

> **结论：AUX 是唯一可靠的“完成信号”，不要用固定 sleep 代替。**

---

## 6. 接收流程（非常简单）

```text
EN = LOW
↓
模块自动监听无线
↓
收到无线数据
↓
数据从 TXD 输出
↓
主控从串口读取
```

接收端无需控制 EN / SET / AUX。

---

## 7. 推荐的软件结构

```text
主程序
 ├─ GPIO 初始化
 ├─ 串口初始化
 ├─ AUX 状态监测线程
 ├─ 发送队列 / 发送函数
 └─ 接收循环
```

* 发送前后使用 AUX 判断状态
* 接收使用阻塞或 readline

---

## 8. 常见问题与判断方法

### Q1：AUX 一直是 HIGH？

* 模块未发生真实无线通信
* AUX 未上拉或接线错误
* AUX 未接到正确 GPIO（BCM ≠ 物理编号）

---

### Q2：能不能不用 AUX？

可以，但后果是：

* 高频发送容易丢包
* 无法判断发送完成
* 不适合网关 / 稳定系统

**工程结论**：

> 只要系统不是一次性 demo，就必须用 AUX。

---

## 9. 最简记忆版（核心结论）

> EN：模块工作开关（长期 LOW）
> UART：唯一数据接口
> AUX：唯一可靠状态信号

**做对这三点，模块就会非常稳定。**

---

## 10. 适用场景

* LoRa 网关
* 树莓派采集节点
* MCU 远程透传
* 毕设 / 项目 / 产品原型

---

（本文档为实践总结版，可直接作为项目 README 使用）
